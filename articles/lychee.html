<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to lychee • lychee</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to lychee">
<meta property="og:description" content="lychee">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lychee</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/lychee.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sumtxt/lychee/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lychee_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to lychee</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sumtxt/lychee/blob/master/vignettes/lychee.Rmd"><code>vignettes/lychee.Rmd</code></a></small>
      <div class="hidden name"><code>lychee.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggrepel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fuzzyjoin</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lychee</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">greens3</span>)</pre></body></html></div>
<p>This vignettes introduces the <code>lychee</code> package and its two core functions: <code>linkr</code> and <code>joinr</code>. Both of these functions are complementary and are powered by the same code. Both ease linking and joining data frames with key variables that are are similar but not identical (e.g., a variable with geographic names spelled slightly different or nearby geographic coordinates). Different from the <code>fuzzyjoin</code> package, the <code>lychee</code> package does not output all matches given some definition of sufficient similarity, but constructs optimal one-to-one matches minimizing the global difference across all matches.</p>
<div id="joining-data-frames" class="section level3">
<h3 class="hasAnchor">
<a href="#joining-data-frames" class="anchor"></a>Joining data frames</h3>
<p>This vignette relies on a simple dataset to illustrates how <code>linkr</code> and <code>joinr</code> work. The dataset <code>greens3</code> which is part of the package includes for each federal and European election the top three counties where Germany’s green party received most votes. In each election, the county name is spelled slightly different - either because the county name changed or because of minor spelling mistakes made during the transcription. The example belows shows the vote shares for the county Freiburg where the Greens received the highest vote share across all 13 elections. Across the 13 observations, there are 5 different spellings for the county.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">greens3</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">city_clean</span><span class="kw">==</span><span class="st">"Freiburg"</span>)
<span class="co">#&gt; # A tibble: 13 x 5</span>
<span class="co">#&gt;    city                             city_clean  year election greens</span>
<span class="co">#&gt;    &lt;chr&gt;                            &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Freiburg im Breisgau, Stadt      Freiburg    1994 BTW        21.9</span>
<span class="co">#&gt;  2 Freiburg im Breisgau, Stadt      Freiburg    1998 BTW        24.1</span>
<span class="co">#&gt;  3 Freiburg im Breisgau, Stadt      Freiburg    2002 BTW        28.7</span>
<span class="co">#&gt;  4 Freiburg im Breisgau             Freiburg    2005 BTW        26.2</span>
<span class="co">#&gt;  5 Freiburg (Breisgau)              Freiburg    2009 BTW        25.4</span>
<span class="co">#&gt;  6 Freiburg im Breisgau             Freiburg    2013 BTW        22.1</span>
<span class="co">#&gt;  7 Freiburg im Breisgau, Stadtkreis Freiburg    2017 BTW        23.3</span>
<span class="co">#&gt;  8 Freiburg im Breisgau, Stadt      Freiburg    1994 EP         29  </span>
<span class="co">#&gt;  9 Freiburg im Breisgau, Stadt      Freiburg    1999 EP         25.8</span>
<span class="co">#&gt; 10 Stadtkreis Freiburg im Breisgau  Freiburg    2004 EP         36.8</span>
<span class="co">#&gt; 11 Freiburg (Breisgau)              Freiburg    2009 EP         32.5</span>
<span class="co">#&gt; 12 Freiburg im Breisgau             Freiburg    2014 EP         27.7</span>
<span class="co">#&gt; 13 Freiburg im Breisgau, Stadtkreis Freiburg    2019 EP         38.5</span></pre></body></html></div>
<p>We will use <code>joinr</code> and <code>linkr</code> to link and join observations that belong to the same county. To facilitate comparisons, the data also includes a standardized version of the county name (<code>name_clean</code>).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">greens3</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">election</span><span class="kw">==</span><span class="st">"BTW"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">city</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(<span class="no">year</span>,<span class="no">greens</span>) <span class="kw">%&gt;%</span>
    <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">city_clean</th>
<th align="left">election</th>
<th align="right">1994</th>
<th align="right">1998</th>
<th align="right">2002</th>
<th align="right">2005</th>
<th align="right">2009</th>
<th align="right">2013</th>
<th align="right">2017</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Darmstadt</td>
<td align="left">BTW</td>
<td align="right"></td>
<td align="right"></td>
<td align="right">20.3</td>
<td align="right"></td>
<td align="right">20.9</td>
<td align="right">17.8</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Freiburg</td>
<td align="left">BTW</td>
<td align="right">21.9</td>
<td align="right">24.1</td>
<td align="right">28.7</td>
<td align="right">26.2</td>
<td align="right">25.4</td>
<td align="right">22.1</td>
<td align="right">23.3</td>
</tr>
<tr class="odd">
<td align="left">Heidelberg</td>
<td align="left">BTW</td>
<td align="right">18.4</td>
<td align="right">18.2</td>
<td align="right">22.9</td>
<td align="right">19.9</td>
<td align="right">22.4</td>
<td align="right">18.9</td>
<td align="right">21.9</td>
</tr>
<tr class="even">
<td align="left">Tübingen</td>
<td align="left">BTW</td>
<td align="right">15.1</td>
<td align="right">17.0</td>
<td align="right"></td>
<td align="right">18.3</td>
<td align="right"></td>
<td align="right"></td>
<td align="right">19.5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="no">greens3</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">election</span><span class="kw">==</span><span class="st">"EP"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">city</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(<span class="no">year</span>,<span class="no">greens</span>) <span class="kw">%&gt;%</span>
    <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">city_clean</th>
<th align="left">election</th>
<th align="right">1994</th>
<th align="right">1999</th>
<th align="right">2004</th>
<th align="right">2009</th>
<th align="right">2014</th>
<th align="right">2019</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Darmstadt</td>
<td align="left">EP</td>
<td align="right"></td>
<td align="right"></td>
<td align="right">27.9</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Flensburg</td>
<td align="left">EP</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right">37.1</td>
</tr>
<tr class="odd">
<td align="left">Freiburg</td>
<td align="left">EP</td>
<td align="right">29.0</td>
<td align="right">25.8</td>
<td align="right">36.8</td>
<td align="right">32.5</td>
<td align="right">27.7</td>
<td align="right">38.5</td>
</tr>
<tr class="even">
<td align="left">Heidelberg</td>
<td align="left">EP</td>
<td align="right">21.9</td>
<td align="right">20.5</td>
<td align="right">28.9</td>
<td align="right">28.6</td>
<td align="right">23.9</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Kiel</td>
<td align="left">EP</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right">37.0</td>
</tr>
<tr class="even">
<td align="left">Lüchow-Dannenberg</td>
<td align="left">EP</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right">29.9</td>
<td align="right">25.6</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Münster</td>
<td align="left">EP</td>
<td align="right">20.7</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Tübingen</td>
<td align="left">EP</td>
<td align="right"></td>
<td align="right">19.3</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>We begin with a simple merge of the observations from the federal election in 1994 and 2017 using the variable <code>name</code> as key variable. To focus on the essentials, the data subsetting and variable selection is omitted.</p>
<p>By default, <code>joinr</code> compares the key variable(s) (the county name in the example) in the two data frames using the <a href="https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">optimal string alignment metric</a> and picks the best combination of 1-to-1 matches such that the sum of the distances between matches is minimized.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">btw94</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   city                        greens</span>
<span class="co">#&gt;   &lt;chr&gt;                        &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                      15.1</span>
<span class="co">#&gt; 2 Heidelberg                    18.4</span>
<span class="co">#&gt; 3 Freiburg im Breisgau, Stadt   21.9</span>
<span class="no">btw17</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   city                             greens</span>
<span class="co">#&gt;   &lt;chr&gt;                             &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                           19.5</span>
<span class="co">#&gt; 2 Heidelberg, Stadtkreis             21.9</span>
<span class="co">#&gt; 3 Freiburg im Breisgau, Stadtkreis   23.3</span>
<span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">btw94</span>,<span class="no">btw17</span>,<span class="kw">by</span><span class="kw">=</span><span class="st">'city'</span>,
    <span class="kw">suffix</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"94"</span>,<span class="st">"17"</span>), <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; Loading required package: stringdist</span>
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   city94                  greens94 match_dist city17                    greens17</span>
<span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                    15.1          0 Tübingen                      19.5</span>
<span class="co">#&gt; 2 Heidelberg                  18.4         12 Heidelberg, Stadtkreis        21.9</span>
<span class="co">#&gt; 3 Freiburg im Breisgau, …     21.9          5 Freiburg im Breisgau, St…     23.3</span></pre></body></html></div>
<p>Under the hood, <code>joinr</code> takes advantage of the <a href="https://cran.r-project.org/web/packages/stringdist/index.html">stringdist</a>-package and constructs a distance matrix that takes the following form:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">stringdistmatrix</span>(<span class="no">btw94</span><span class="kw">[[</span><span class="st">'city'</span>]],
    <span class="no">btw17</span><span class="kw">[[</span><span class="st">'city'</span>]])
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    0   19   28</span>
<span class="co">#&gt; [2,]    9   12   28</span>
<span class="co">#&gt; [3,]   24   21    5</span></pre></body></html></div>
<p>Each entry in this matrix describes the string distance between a county name in 1994 and a county name in 2017.</p>
<p>To find one-to-one matches, <code>joinr</code> applies a fast version of the <a href="https://en.wikipedia.org/wiki/Hungarian_algorithm">Hungarian algorithm</a> to the distance matrix. This algorithm assigns each row of the distance matrix to a column such that the sum of cell values is as small as possible. In the context of the running example, the algorithm finds the best combination of county names from 1994 and 2017 such that the total string distance between them is as small as possible. The solution, as shown above, is a set of three matches with a total string distance of 17 (0+12+5 in the above matrix).</p>
<p>The algorithm, implemented in the assignment function from the <a href="https://cran.r-project.org/web/packages/adagio/index.html">adagio package</a> only takes into account the integer part of the distance matrix. The decimal part is ignored. For many string distance metrics this is not relevant as they the distance matrix consists of integers only. A warning is printed if the distance matrix does not consist of integers but real values (“Warning in assignment(m): Matrix ‘cmat’ not integer; will take floor of it.”). In these situations, it might be useful to scale the distance matrix by some constant to increase precision. The scaling parameter can be defined via the parameter parameter <code>C</code> which by default is 1.</p>
<p>The application of the Hungarian algorithm to the distance matrix sets <code>joinr</code> apart from <code>fuzzyjoin</code>. The function <code>stringdist_full_join</code> which is part of the <code>fuzzyjoin</code> package also relies on a string distance matrix but any combination with a distance value of less than a cutoff is considered a match. In other words, <code>fuzzyjoin</code> does not enforce a one-to-one constraint when constructing matches. While this is an desirable in some situation, it isn’t in others.</p>
<p>In the context of the running example, it is clearly undesirable as we only wish to match each observation once. When using <code>fuzzyjoin</code> with the running example (and relying on the package’s default cutoff value of <code>2</code>), we find that not all observations are correctly matched. When increasing the cutoff value, more matches are formed but Tübingen and Heidelberg in 1994 are matched with Tübingen in 2017 leaving Heidelberg 2017 without a match.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Using the fuzzyjoin package instead of lychee here</span>
<span class="fu"><a href="https://rdrr.io/pkg/fuzzyjoin/man/stringdist_join.html">stringdist_full_join</a></span>(<span class="no">btw94</span>,<span class="no">btw17</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'osa'</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'city'</span>, <span class="kw">max_dist</span><span class="kw">=</span><span class="fl">2</span>)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   city.x                      greens.x city.y                           greens.y</span>
<span class="co">#&gt;   &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;                               &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                        15.1 Tübingen                             19.5</span>
<span class="co">#&gt; 2 Heidelberg                      18.4 &lt;NA&gt;                                 NA  </span>
<span class="co">#&gt; 3 Freiburg im Breisgau, Stadt     21.9 &lt;NA&gt;                                 NA  </span>
<span class="co">#&gt; 4 &lt;NA&gt;                            NA   Heidelberg, Stadtkreis               21.9</span>
<span class="co">#&gt; 5 &lt;NA&gt;                            NA   Freiburg im Breisgau, Stadtkreis     23.3</span>

<span class="fu"><a href="https://rdrr.io/pkg/fuzzyjoin/man/stringdist_join.html">stringdist_full_join</a></span>(<span class="no">btw94</span>,<span class="no">btw17</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'osa'</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'city'</span>, <span class="kw">max_dist</span><span class="kw">=</span><span class="fl">10</span>)
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   city.x                      greens.x city.y                           greens.y</span>
<span class="co">#&gt;   &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;                               &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                        15.1 Tübingen                             19.5</span>
<span class="co">#&gt; 2 Heidelberg                      18.4 Tübingen                             19.5</span>
<span class="co">#&gt; 3 Freiburg im Breisgau, Stadt     21.9 Freiburg im Breisgau, Stadtkreis     23.3</span>
<span class="co">#&gt; 4 &lt;NA&gt;                            NA   Heidelberg, Stadtkreis               21.9</span></pre></body></html></div>
</div>
<div id="settings-for-joinr" class="section level3">
<h3 class="hasAnchor">
<a href="#settings-for-joinr" class="anchor"></a>Settings for <code>joinr</code>
</h3>
<p>By default <code>joinr</code> uses optimal string alignment as a distance metric but other distance metrics can be used. Changes in the metric can go a long way when <code>joinr</code> produces suboptimal matches as the next example with the election outcomes from 2013 and 2017 illustrates.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">btw13</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   city                          greens</span>
<span class="co">#&gt;   &lt;chr&gt;                          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Darmstadt, Wissenschaftsstadt   17.8</span>
<span class="co">#&gt; 2 Heidelberg                      18.9</span>
<span class="co">#&gt; 3 Freiburg im Breisgau            22.1</span>
<span class="no">btw17</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   city                             greens</span>
<span class="co">#&gt;   &lt;chr&gt;                             &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                           19.5</span>
<span class="co">#&gt; 2 Heidelberg, Stadtkreis             21.9</span>
<span class="co">#&gt; 3 Freiburg im Breisgau, Stadtkreis   23.3</span>
<span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">btw13</span>,<span class="no">btw17</span>,<span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"city"</span>),
    <span class="kw">suffix</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"94"</span>,<span class="st">"17"</span>),
    <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   city94                  greens94 match_dist city17                    greens17</span>
<span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Darmstadt, Wissenschaf…     17.8         26 Heidelberg, Stadtkreis        21.9</span>
<span class="co">#&gt; 2 Heidelberg                  18.9          9 Tübingen                      19.5</span>
<span class="co">#&gt; 3 Freiburg im Breisgau        22.1         12 Freiburg im Breisgau, St…     23.3</span></pre></body></html></div>
<p>The default settings lead to a suboptimal join. A change to the longest common substring distance improves the result. Users may use any string distance metric that is part of the <code>stringdist</code> package.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">btw13</span>,<span class="no">btw17</span>,<span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"city"</span>),
    <span class="kw">suffix</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"94"</span>,<span class="st">"17"</span>),
    <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>)
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   city94                  greens94 match_dist city17                    greens17</span>
<span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Darmstadt, Wissenschaf…     17.8         31 Tübingen                      19.5</span>
<span class="co">#&gt; 2 Heidelberg                  18.9         12 Heidelberg, Stadtkreis        21.9</span>
<span class="co">#&gt; 3 Freiburg im Breisgau        22.1         12 Freiburg im Breisgau, St…     23.3</span></pre></body></html></div>
<p>The result is still suboptimal as it matches the city of Darmstadt with the city of Tübingen. This is because by default, <code>joinr</code> matches every row in a (shorter) data frame with a row in a (longer) data frame. This behavior is useful when one data frame is known to be a subset of the other. If that is not the case and there is only a partial overlap, the <code>caliper</code> parameter is useful. It regulates up to which distance two rows are considered a match. Reducing the caliper value reduces the number of matches. Some iterative trial and error is necessary to choose a sensible value. The parameter <code>full</code> regulates if unmatched rows from the shorter data frame should be appended to the output (<code>full=TRUE</code>, the default) or dropped (<code>full=FALSE</code>).</p>
<p>Applying the caliper value to the example above leads to a perfect result.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">btw13</span>,<span class="no">btw17</span>,<span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"city"</span>),
    <span class="kw">suffix</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"94"</span>,<span class="st">"17"</span>),
    <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>,
    <span class="kw">caliper</span><span class="kw">=</span><span class="fl">12</span>, <span class="kw">full</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   city94                  greens94 match_dist city17                    greens17</span>
<span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Darmstadt, Wissenschaf…     17.8         NA &lt;NA&gt;                          NA  </span>
<span class="co">#&gt; 2 Heidelberg                  18.9         12 Heidelberg, Stadtkreis        21.9</span>
<span class="co">#&gt; 3 Freiburg im Breisgau        22.1         12 Freiburg im Breisgau, St…     23.3</span>
<span class="co">#&gt; 4 &lt;NA&gt;                        NA           NA Tübingen                      19.5</span></pre></body></html></div>
<p>In many situations it might be useful to perform the above operations within certain groups. Consider the task of matching the vote shares for 1994 and 2009 in both the federal elections (<code>election='BTW'</code>) and the European parliament elections (<code>election='EP'</code>). Without constraining the matching to proceed within the two groups, we might end up with matches that merge observations from the federal and the European parliament elections as the example demonstrates.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">elec94</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   city                        election greens</span>
<span class="co">#&gt;   &lt;chr&gt;                       &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                    BTW        15.1</span>
<span class="co">#&gt; 2 Heidelberg, Stadt           BTW        18.4</span>
<span class="co">#&gt; 3 Freiburg im Breisgau, Stadt BTW        21.9</span>
<span class="co">#&gt; 4 Münster, Stadt              EP         20.7</span>
<span class="co">#&gt; 5 Heidelberg, Stadt           EP         21.9</span>
<span class="co">#&gt; 6 Freiburg im Breisgau, Stadt EP         29</span>
<span class="no">elec09</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   city                          election greens</span>
<span class="co">#&gt;   &lt;chr&gt;                         &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Darmstadt, Wissenschaftsstadt BTW        20.9</span>
<span class="co">#&gt; 2 Heidelberg                    BTW        22.4</span>
<span class="co">#&gt; 3 Freiburg (Breisgau)           BTW        25.4</span>
<span class="co">#&gt; 4 Heidelberg                    EP         28.6</span>
<span class="co">#&gt; 5 Lüchow-Dannenberg             EP         29.9</span>
<span class="co">#&gt; 6 Freiburg (Breisgau)           EP         32.5</span>
<span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">elec94</span>,<span class="no">elec09</span>,
    <span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"city"</span>),
    <span class="kw">suffix</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"94"</span>,<span class="st">"09"</span>),
    <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>,
    <span class="kw">caliper</span><span class="kw">=</span><span class="fl">12</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>,<span class="kw">full</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 8 x 7</span>
<span class="co">#&gt;   city94        election94 greens94 match_dist city09        election09 greens09</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen      BTW            15.1         NA &lt;NA&gt;          &lt;NA&gt;           NA  </span>
<span class="co">#&gt; 2 Heidelberg, … BTW            18.4          7 Heidelberg    EP             28.6</span>
<span class="co">#&gt; 3 Freiburg im … BTW            21.9         12 Freiburg (Br… BTW            25.4</span>
<span class="co">#&gt; 4 Münster, Sta… EP             20.7         NA &lt;NA&gt;          &lt;NA&gt;           NA  </span>
<span class="co">#&gt; 5 Heidelberg, … EP             21.9          7 Heidelberg    BTW            22.4</span>
<span class="co">#&gt; 6 Freiburg im … EP             29           12 Freiburg (Br… EP             32.5</span>
<span class="co">#&gt; 7 &lt;NA&gt;          &lt;NA&gt;           NA           NA Lüchow-Danne… EP             29.9</span>
<span class="co">#&gt; 8 &lt;NA&gt;          &lt;NA&gt;           NA           NA Darmstadt, W… BTW            20.9</span></pre></body></html></div>
<p>Fortunately, <code>joinr</code> allows to join observations only within groups using the parameter <code>strata</code>. In principle, strata can be defined by a series of variables, where each combination of values defines a strata.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">elec94</span>,<span class="no">elec09</span>,<span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"city"</span>),
    <span class="kw">strata</span><span class="kw">=</span><span class="st">'election'</span>,
    <span class="kw">suffix</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"94"</span>,<span class="st">"09"</span>),
    <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>,
    <span class="kw">caliper</span><span class="kw">=</span><span class="fl">12</span>, <span class="kw">full</span><span class="kw">=</span><span class="fl">TRUE</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>)
<span class="co">#&gt; # A tibble: 8 x 6</span>
<span class="co">#&gt;   election city94              greens94 match_dist city09               greens09</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 BTW      Tübingen                15.1         NA &lt;NA&gt;                     NA  </span>
<span class="co">#&gt; 2 BTW      Heidelberg, Stadt       18.4          7 Heidelberg               22.4</span>
<span class="co">#&gt; 3 BTW      Freiburg im Breisg…     21.9         12 Freiburg (Breisgau)      25.4</span>
<span class="co">#&gt; 4 BTW      &lt;NA&gt;                    NA           NA Darmstadt, Wissensc…     20.9</span>
<span class="co">#&gt; 5 EP       Münster, Stadt          20.7         NA &lt;NA&gt;                     NA  </span>
<span class="co">#&gt; 6 EP       Heidelberg, Stadt       21.9          7 Heidelberg               28.6</span>
<span class="co">#&gt; 7 EP       Freiburg im Breisg…     29           12 Freiburg (Breisgau)      32.5</span>
<span class="co">#&gt; 8 EP       &lt;NA&gt;                    NA           NA Lüchow-Dannenberg        29.9</span></pre></body></html></div>
</div>
<div id="linking-one-and-many-observations" class="section level3">
<h3 class="hasAnchor">
<a href="#linking-one-and-many-observations" class="anchor"></a>Linking one and many observations</h3>
<p>While <code>joinr</code> joins data frames, <code>linkr</code> assigns a common identifier to matching observations. Going back to the first example with the election outcomes from 1994 and 2017, we assign a common identifier to the stacked data frame instead of merging columns of one data frame with the columns in another.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/linkr_joinr.html">linkr</a></span>(<span class="no">btw94</span>,<span class="no">btw17</span>,<span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"city"</span>),
    <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>,
    <span class="kw">caliper</span><span class="kw">=</span><span class="fl">12</span>,
    <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>) <span class="kw">%&gt;%</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">match_id</span>)
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   city                             greens match_id match_dist</span>
<span class="co">#&gt;   &lt;chr&gt;                             &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Tübingen                           15.1        1          0</span>
<span class="co">#&gt; 2 Tübingen                           19.5        1          0</span>
<span class="co">#&gt; 3 Heidelberg                         18.4        2         12</span>
<span class="co">#&gt; 4 Heidelberg, Stadtkreis             21.9        2         12</span>
<span class="co">#&gt; 5 Freiburg im Breisgau, Stadt        21.9        3          5</span>
<span class="co">#&gt; 6 Freiburg im Breisgau, Stadtkreis   23.3        3          5</span></pre></body></html></div>
<p>In all of the above examples, we used <code>joinr</code> and <code>linkr</code> to constructed one-to-one matches between two data frames. But in some situations we might wish to construct a chain of matches. For example, we might wish to assign a common identifier to all observations of the same county across six federal elections.</p>
<p>To facilitate such linkage, the package provides the function <code>linkr_multi</code> which constructs matches iteratively. The first two data frames are matched as with <code>linkr</code>. The function then selects one observation per matched pair (and all singletons) and matches those with the third data frame. Selecting again one observation per matched tuple, the function matches those with the fourth data frame and so forth. By default, the last observation per matched pair is used (this can be changed).</p>
<p>The output below illustrates the application to the running example. For an optimal result, it is necessary to select a slightly higher caliper value then before.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/linkr_multi.html">linkr_multi</a></span>(
        <span class="kw">df</span><span class="kw">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">greens3</span>, <span class="no">election</span><span class="kw">==</span><span class="st">"BTW"</span>),
        <span class="kw">by</span><span class="kw">=</span><span class="st">'city'</span>,
        <span class="kw">slice</span><span class="kw">=</span><span class="st">'year'</span>,
        <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>,
        <span class="kw">caliper</span><span class="kw">=</span><span class="fl">15</span>) <span class="kw">%&gt;%</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">match_id</span>,<span class="no">year</span>) <span class="kw">%&gt;%</span>
    <span class="no">data.frame</span>
<span class="co">#&gt;                                city city_clean year election greens match_id</span>
<span class="co">#&gt; 1                          Tübingen   Tübingen 1994      BTW   15.1        1</span>
<span class="co">#&gt; 2                         Tuebingen   Tübingen 1998      BTW   17.0        1</span>
<span class="co">#&gt; 3                          Tübingen   Tübingen 2005      BTW   18.3        1</span>
<span class="co">#&gt; 4                          Tübingen   Tübingen 2017      BTW   19.5        1</span>
<span class="co">#&gt; 5                 Heidelberg, Stadt Heidelberg 1994      BTW   18.4        2</span>
<span class="co">#&gt; 6                 Heidelberg, Stadt Heidelberg 1998      BTW   18.2        2</span>
<span class="co">#&gt; 7                 Heidelberg, Stadt Heidelberg 2002      BTW   22.9        2</span>
<span class="co">#&gt; 8                       Heidelberg  Heidelberg 2005      BTW   19.9        2</span>
<span class="co">#&gt; 9                        Heidelberg Heidelberg 2009      BTW   22.4        2</span>
<span class="co">#&gt; 10                       Heidelberg Heidelberg 2013      BTW   18.9        2</span>
<span class="co">#&gt; 11           Heidelberg, Stadtkreis Heidelberg 2017      BTW   21.9        2</span>
<span class="co">#&gt; 12      Freiburg im Breisgau, Stadt   Freiburg 1994      BTW   21.9        3</span>
<span class="co">#&gt; 13      Freiburg im Breisgau, Stadt   Freiburg 1998      BTW   24.1        3</span>
<span class="co">#&gt; 14      Freiburg im Breisgau, Stadt   Freiburg 2002      BTW   28.7        3</span>
<span class="co">#&gt; 15             Freiburg im Breisgau   Freiburg 2005      BTW   26.2        3</span>
<span class="co">#&gt; 16              Freiburg (Breisgau)   Freiburg 2009      BTW   25.4        3</span>
<span class="co">#&gt; 17             Freiburg im Breisgau   Freiburg 2013      BTW   22.1        3</span>
<span class="co">#&gt; 18 Freiburg im Breisgau, Stadtkreis   Freiburg 2017      BTW   23.3        3</span>
<span class="co">#&gt; 19                 Darmstadt, Stadt  Darmstadt 2002      BTW   20.3        4</span>
<span class="co">#&gt; 20    Darmstadt, Wissenschaftsstadt  Darmstadt 2009      BTW   20.9        4</span>
<span class="co">#&gt; 21    Darmstadt, Wissenschaftsstadt  Darmstadt 2013      BTW   17.8        4</span></pre></body></html></div>
<p>In this examples there are lots of matches to discover which makes it an easy case for <code>linkr_multi</code>. When there are fewer (true) matches, the false positive rate typically goes up and even after playing around with the caliper, the linking is imperfect as the next example with the subset of observations from the European elections demonstrates. In the example below the caliper was selected to have zero false positives which leaves two observations from Heidelberg and Freiburg unlinked.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/linkr_multi.html">linkr_multi</a></span>(
        <span class="kw">df</span><span class="kw">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">greens3</span>, <span class="no">election</span><span class="kw">==</span><span class="st">"EP"</span>),
        <span class="kw">by</span><span class="kw">=</span><span class="st">'city'</span>,
        <span class="kw">slice</span><span class="kw">=</span><span class="st">'year'</span>,
        <span class="kw">method</span><span class="kw">=</span><span class="st">'lcs'</span>,
        <span class="kw">caliper</span><span class="kw">=</span><span class="fl">9</span>) <span class="kw">%&gt;%</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">city_clean</span>) <span class="kw">%&gt;%</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">match_id</span>,<span class="no">year</span>) <span class="kw">%&gt;%</span>
    <span class="no">data.frame</span>
<span class="co">#&gt;                                city year election greens match_id</span>
<span class="co">#&gt; 1                 Heidelberg, Stadt 1994       EP   21.9        1</span>
<span class="co">#&gt; 2                 Heidelberg, Stadt 1999       EP   20.5        1</span>
<span class="co">#&gt; 3                        Heidelberg 2009       EP   28.6        1</span>
<span class="co">#&gt; 4                        Heidelberg 2014       EP   23.9        1</span>
<span class="co">#&gt; 5       Freiburg im Breisgau, Stadt 1994       EP   29.0        2</span>
<span class="co">#&gt; 6       Freiburg im Breisgau, Stadt 1999       EP   25.8        2</span>
<span class="co">#&gt; 7  Freiburg im Breisgau, Stadtkreis 2019       EP   38.5        2</span>
<span class="co">#&gt; 8                 Lüchow-Dannenberg 2009       EP   29.9        3</span>
<span class="co">#&gt; 9                 Lüchow Dannenberg 2014       EP   25.6        3</span>
<span class="co">#&gt; 10              Freiburg (Breisgau) 2009       EP   32.5        4</span>
<span class="co">#&gt; 11             Freiburg im Breisgau 2014       EP   27.7        4</span>
<span class="co">#&gt; 12                   Münster, Stadt 1994       EP   20.7        5</span>
<span class="co">#&gt; 13                         Tübingen 1999       EP   19.3        6</span>
<span class="co">#&gt; 14                 Darmstadt, Stadt 2004       EP   27.9        7</span>
<span class="co">#&gt; 15            Stadtkreis Heidelberg 2004       EP   28.9        8</span>
<span class="co">#&gt; 16  Stadtkreis Freiburg im Breisgau 2004       EP   36.8        9</span>
<span class="co">#&gt; 17           Kiel, Landeshauptstadt 2019       EP   37.0       10</span>
<span class="co">#&gt; 18                 Flensburg, Stadt 2019       EP   37.1       11</span></pre></body></html></div>
</div>
<div id="using-geographic-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#using-geographic-distances" class="anchor"></a>Using Geographic Distances</h3>
<p>All previous examples use the city name to link and join data frames. The next example is one where we use geographic coordinates as key variables. That said, in principle users can also define their own distance function and use that within <code>joinr</code> or <code>linkr</code>.</p>
<p>To illustrate how to use geographic distance functions, we use the <code>OldMaps</code> data from the package <a href="https://cran.r-project.org/web/packages/HistData/index.html"><code>HistData</code></a> which includes the latitudes and longitudes of 39 places on 11 old maps drawn between 1688 and 1818 as well as the actual geographic coordinates.</p>
<p>In the example below we check how well we can link the actual coordinates with that from the youngest map of 1818. The plot below shows the actual coordinates as well as those from the drawn map plus the links as constructed using <code>linkr</code>. In total, <code>linkr</code> is able to link 35 out of 39 points correctly. The accuracy declines for older maps as one might expect (not shown).</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">HistData</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">OldMaps</span>)

<span class="no">OldMaps</span> <span class="kw">&lt;-</span> <span class="no">OldMaps</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lat</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">lat</span>),
            <span class="kw">long</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">long</span>))

<span class="no">m1818</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">OldMaps</span>, <span class="no">name</span><span class="kw">==</span><span class="st">"Melish"</span>)
<span class="no">mtruth</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">OldMaps</span>, <span class="no">name</span><span class="kw">==</span><span class="st">"Actual"</span>)

<span class="fu"><a href="../reference/linkr_joinr.html">linkr</a></span>(<span class="no">mtruth</span>,<span class="no">m1818</span>,
        <span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"long"</span>,<span class="st">"lat"</span>),
        <span class="kw">method</span><span class="kw">=</span><span class="st">'haversine'</span>,
        <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">long</span>),<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">lat</span>),
            <span class="kw">group</span><span class="kw">=</span><span class="no">match_id</span>, <span class="kw">color</span><span class="kw">=</span><span class="no">name</span>)) +
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()
<span class="co">#&gt; Loading required package: geosphere</span>
<span class="co">#&gt; Warning in assignment(m): Matrix 'cmat' not integer; will take floor of it.</span></pre></body></html></div>
<p><img src="lychee_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r">
<span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/linkr_joinr.html">joinr</a></span>(<span class="no">mtruth</span>,<span class="no">m1818</span>,
        <span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"long"</span>,<span class="st">"lat"</span>),
        <span class="kw">method</span><span class="kw">=</span><span class="st">'haversine'</span>,
        <span class="kw">add_distance</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; Warning in assignment(m): Matrix 'cmat' not integer; will take floor of it.</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">out</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">point.y</span><span class="kw">==</span><span class="no">point.x</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt; FALSE  TRUE </span>
<span class="co">#&gt;     4    35</span></pre></body></html></div>
</div>
<div id="when-not-to-use-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#when-not-to-use-the-package" class="anchor"></a>When not to use the package</h3>
<p>The package is written to ease linking and joining data frames based on 1-2 key variables that uniquely identify observations in the input datasets (possibly within strata). In situation where linking should be based on comparing and weighting the similarity of a number of variables, other packages such as as <a href="https://cran.r-project.org/web/packages/fastLink/index.html">fastLink</a> might be superior.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://moritz-marbach.com/">Moritz Marbach</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
